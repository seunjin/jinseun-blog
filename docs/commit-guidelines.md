# 커밋 규칙 가이드

이 문서는 레포지토리 내 변경 사항을 안전하고 일관되게 기록하기 위한 절차와 메시지 규칙을 정의합니다. 작업 전후로 아래 항목을 확인해 주세요.

## 커밋 준비 체크리스트
1. **변경 범위 정리** – 한 가지 주제(기능, 버그 수정 등)에 집중해 커밋 크기를 관리합니다.
2. **포맷/린트 실행** – `pnpm format`, `pnpm lint` 순으로 실행해 Biome 규칙을 만족합니다.
3. **테스트 확인** – 향후 테스트 스크립트가 추가될 것을 대비해 관련 명령어를 실행합니다. 테스트가 없다면 수동 점검 결과를 로그에 기록합니다.
4. **로그 갱신** – 필요 시 `logs/` 폴더의 월별 `.jsonl` 파일에 세션 기록을 append 합니다.
5. **작업 내용 검토** – `git status`, `git diff`로 변경 파일을 확인하고 불필요한 수정이 포함되지 않았는지 체크합니다.

## 커밋 타입 정의
아래 타입을 기본으로 사용하며, 필요 시 스코프(예: `feat(header): ...`)를 추가해 영역을 명확히 합니다.

| 타입 | 사용 시점 | 예시 | 비고 |
| --- | --- | --- | --- |
| **feat** | 사용자에게 보이는 새 기능 추가 | `feat: 태그 필터 기능 추가` | API 변경으로 이어질 경우 본문에 명시 |
| **fix** | 버그 수정, 회귀 해결 | `fix: 다크 모드에서 텍스트 색상 복구` | 버그 원인과 테스트 결과를 본문에 요약 |
| **docs** | 문서, README, 주석 보완 | `docs: 프로젝트 규칙 한글화` | 주석/가이드 변경 모두 포함 |
| **refactor** | 기능 변화 없이 내부 구조 개선 | `refactor: 포스트 목록 정렬 로직 단순화` | 동작 변화가 있다면 `feat` 또는 `fix`로 분류 |
| **style** | 코드 포맷팅, 세미콜론, 공백 조정 등 | `style: Biome 자동 포맷 적용` | 로직 변경이 없어야 함 |
| **test** | 테스트 코드 추가/수정 | `test: 필터 유닛 테스트 보강` | 실패한 테스트를 고칠 때는 `fix`와 함께 사용 고려 |
| **build** | 빌드 시스템, 배포 설정 변경 | `build: Vercel 환경 변수 추가` | 빌드 툴, 패키지 업데이트 포함 |
| **chore** | 유지보수성 작업, 의존성 업데이트, 설정 변경 | `chore: pnpm-lock.yaml 재생성` | 사용자 영향이 거의 없는 작업 |
| **perf** | 성능 최적화 | `perf: 이미지 lazyload 임계값 조정` | 성능 향상을 정량적으로 본문에 기록 |
| **ci** | CI 파이프라인, GitHub Actions 수정 | `ci: 테스트 워크플로 캐시 최적화` | 로컬 빌드와 구분하기 위해 독립 타입 유지 |
| **revert** | 이전 커밋 되돌리기 | `revert: feat: 태그 필터 기능 추가` | 원본 커밋 해시를 본문에 기입 |

> 참고: 타입은 필요 시 확장 가능하지만, 의미가 모호해지지 않도록 위 표에서 커버되지 않는 경우에만 추가합니다.

### 커밋 메시지 작성 규칙
- 기본 형식: `타입(선택적 스코프): 한 줄 요약`
- 요약은 한국어로 작성하고, 필요한 영어 용어는 그대로 사용합니다.
- 본문에는 변경 이유, 테스트 결과, 관련 로그 경로를 bullet로 정리합니다.
- 관련 이슈가 있으면 마지막 줄에 `Refs:` 또는 `Resolves:` 형태로 링크합니다.

### 예시 메시지
```
feat: 블로그 포스트 상세 페이지 초안 추가

- API mock 데이터로 렌더링 동작 확인
- logs/2024-05.jsonl 업데이트
```

## 커밋 단위와 브랜치 전략
- `main` 브랜치는 항상 배포 가능한 상태를 유지합니다.
- 새로운 작업은 기능 브랜치(`feature/...`, `fix/...`)에서 진행 후 PR 혹은 `main`에 fast-forward 병합합니다.
- 리뷰가 필요한 경우 `docs/project-guidelines.md` 규칙을 함께 공유합니다.

## Lefthook 사용 여부 및 권장 사항
Lefthook은 git hook 관리 툴로, 커밋 전에 자동으로 포맷/린트 등을 실행해 규칙 위반을 방지할 수 있습니다.

| 항목 | 장점 | 고려 사항 |
| --- | --- | --- |
| **사전 커밋 자동화** | `pnpm format`, `pnpm lint`를 자동 실행해 메시지 규칙과 포맷이 일치하도록 돕습니다. | 최초 설정 시 `lefthook.yml` 구성과 패키지 설치가 필요합니다. |
| **일관성** | AI 어시스턴트와 사용자가 같은 규칙을 강제 적용할 수 있습니다. | 훅 실패 시 커밋이 차단되므로 비상 시 우회 방법(`LEFTHOOK=0`)을 숙지해야 합니다. |
| **속도** | Biome 기반 포맷/린트는 빠른 편이라 지연이 크지 않습니다. | 대규모 변경으로 시간이 오래 걸릴 경우, 부분 커밋으로 나눌 필요가 있습니다. |

### 도입 권장 결론
- 앞으로 AI 어시스턴트와 사용자가 동일한 규칙을 따르기를 원한다면 **Lefthook 도입을 권장**합니다. 훅을 통해 포맷/린트를 선반영하면 커밋 단위가 안정적으로 유지됩니다.
- 도입 후에도 임시로 훅을 비활성화할 때는 `LEFTHOOK=0 git commit ...`을 명시적으로 사용합니다.

### Lefthook 도입 절차
1. `pnpm add -D lefthook` 설치.
2. `lefthook install` 실행(once).
3. 루트에 `lefthook.yml` 작성:
   ```yml
   pre-commit:
     parallel: true
     commands:
       format:
         run: pnpm format
       lint:
         run: pnpm lint
   ```
4. 필요 시 `pre-push` hook에 테스트 명령을 추가하거나, 향후 E2E/통합 테스트가 도입되면 분리된 커맨드로 확장합니다.

도입 여부와 관계없이, 커밋 전 체크리스트와 타입 규칙을 항상 준수해 주세요.
